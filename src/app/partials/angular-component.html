
<script src="/libs/angular/angular.min.js"></script>
<script src="/libs/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js"></script>
<link href="/libs/angular-ui-bootstrap/dist/ui-bootstrap-csp.css" rel="stylesheet">

<link rel="import" href="form-field.html">

<script>
  function angularPanel() {
    return {
      restrict: 'E',
      scope: {
        persons: '='
      },
      templateUrl: 'angular-panel.html',
      controller: ['$timeout', function($timeout) {
        var vm = this;

        vm.date = new Date();
        vm.dateString = vm.date.toLocaleDateString();
        vm.opened = false;
        vm.updateDate = updateDate;
        vm.setDate = setDate;

        document.addEventListener('date.change', vm.setDate, false);

        function updateDate() {
          var event = document.createEvent('Event');
          event.initEvent('date.change', true, true);
          event.date = vm.date;
          document.dispatchEvent(event);
        }
        function setDate() {
          $timeout(function() {
            vm.date = window.date;
          }, 0);
        }
      }],
      controllerAs: 'panel'
    };
  }
</script>

<dom-module id="angular-component">
  <template>
    <script type="text/ng-template" id="angular-panel.html">
      <div class="panel panel-info">
        <div class="panel-heading">
          Angular
        </div>
        <div class="panel-body">
          <label class="form-group">
            Angular
            <input class="form-control" ng-model="panel.date" uib-datepicker-popup is-open="panel.opened" ng-focus="panel.opened = true" ng-blue="panel.opened = false" ng-change="panel.updateDate()">
          </label>
          <label class="form-group">
            Polymer
            <form-field type="date" name="date" value="{{::panel.dateString}}"></form-field>
          </label>
        </div>
      </div>
    </script>
    <angular-panel>
      <!-- The component will be rendered here -->
    </angular-panel>
  </template>

  <script>
    // Represents a ordinary polymer component

    Polymer({
      is: 'angular-component',
      properties: {
        variation: 0,
        fullbleed: {
          type: Boolean,
          value: true
        }
      },
      ready: function() {
        angular.module('app', ['ui.bootstrap'])
          .directive('angularPanel', angularPanel);

        angular.bootstrap(this, ['app']);
      }
    });
  </script>
</dom-module>
